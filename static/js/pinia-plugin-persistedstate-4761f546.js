function _(e){return typeof e=="object"&&e!==null}function g(e,r){return e=_(e)?e:Object.create(null),new Proxy(e,{get(n,t,i){return Reflect.get(n,t,i)||Reflect.get(r,t,i)}})}function m(e,r){return r.reduce((n,t)=>n==null?void 0:n[t],e)}function p(e,r,n){return r.slice(0,-1).reduce((t,i)=>/^(__proto__)$/.test(i)?{}:t[i]=t[i]||{},e)[r[r.length-1]]=n,e}function S(e,r){return r.reduce((n,t)=>{const i=t.split(".");return p(n,i,m(e,i))},{})}function h(e,r,n,t){try{const i=r==null?void 0:r.getItem(t);i&&e.$patch(n==null?void 0:n.deserialize(i))}catch{}}function v(e={}){return r=>{const{options:{persist:n},store:t}=r;if(!n)return;const i=(Array.isArray(n)?n.map(l=>g(l,e)):[g(n,e)]).map(({storage:l=localStorage,beforeRestore:o=null,afterRestore:u=null,serializer:s={serialize:JSON.stringify,deserialize:JSON.parse},key:a=t.$id,paths:c=null})=>({storage:l,beforeRestore:o,afterRestore:u,serializer:s,key:a,paths:c}));i.forEach(l=>{const{storage:o,serializer:u,key:s,paths:a,beforeRestore:c,afterRestore:f}=l;c==null||c(r),h(t,o,u,s),f==null||f(r),t.$subscribe((z,d)=>{try{const y=Array.isArray(a)?S(d,a):d;o.setItem(s,u.serialize(y))}catch{}},{detached:!0})}),t.$hydrate=({runHooks:l=!0}={})=>{i.forEach(o=>{const{beforeRestore:u,afterRestore:s,storage:a,serializer:c,key:f}=o;l&&(u==null||u(r)),h(t,a,c,f),l&&(s==null||s(r))})}}}var R=v();export{R as s};
