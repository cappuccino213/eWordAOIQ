import{j as h,w as re,v as ne,l as ie}from"./element-plus-df419614.js";import{u as ue}from"./@vueuse-7330b134.js";import{d as k}from"./dayjs-d69067b3.js";import{_ as ce,l as j}from"./index-66a691da.js";import{u as pe}from"./dateChange-eb10ac1f.js";import{u as de,d as fe,c as me}from"./index-4495a6b8.js";import{u as ve}from"./loggedInfo-268f6dc2.js";import{r as f,a0 as C,d as ge,w as V,a4 as R,o as L,c as I,X as u,Q as d,u as y,a as he,E as De,V as T}from"./@vue-500f6e4a.js";import"./lodash-es-8e578a42.js";import"./@element-plus-58134fba.js";import"./@popperjs-892fd7f5.js";import"./@ctrl-eb0b847c.js";import"./async-validator-efc2d198.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";import"./@floating-ui-d1015eb5.js";import"./axios-805d1980.js";import"./vue-router-a3c91db2.js";import"./lodash-4ca21166.js";import"./pinia-d75d73cf.js";import"./pinia-plugin-persistedstate-4761f546.js";import"./index-f3494083.js";const we=[{type:"input",value:"",label:"\u6D4B\u8BD5\u5355ID",prop:"testTaskID",attrs:{style:{width:"100%"},clearable:!0}},{type:"select",value:"",label:"\u4EA7\u54C1\u540D\u79F0",prop:"product",attrs:{style:{width:"100%"},clearable:!0},children:[]},{type:"select",value:"",label:"\u6D4B\u8BD5\u4EBA",prop:"tester",attrs:{style:{width:"100%"},clearable:!0},children:[]},{type:"select",value:"",label:"\u5931\u8D25\u8D23\u4EFB\u4EBA",prop:"relatedPerson",attrs:{style:{width:"100%"},clearable:!0},children:[]},{type:"select",value:"",label:"\u5192\u70DF\u7ED3\u679C",prop:"smokeResult",attrs:{style:{width:"100%"},clearable:!0},children:[{type:"option",label:"\u6210\u529F",value:"pass"},{type:"option",label:"\u5931\u8D25",value:"fail"}]},{type:"date-picker",value:[k(new Date(new Date().getTime()-3600*1e3*24*3).setHours(0,0,0)).format("YYYY-MM-DD HH:mm:ss"),k(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")],label:"\u65F6\u95F4",prop:"dateRange",rules:[{required:!0,message:"\u65E5\u671F\u9009\u62E9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],attrs:{style:{width:"100%"},type:"daterange",rangeSeparator:"\u81F3",startPlaceholder:"\u5F00\u59CB\u65E5\u671F",endPlaceholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD HH:mm:ss",shortcuts:[{text:"\u4ECA\u5929",value:()=>{const r=new Date().setHours(0,0,0),o=new Date().setHours(23,59,59);return[r,o]}},{text:"\u4E00\u5468\u5185",value:()=>{const r=new Date().setHours(23,59,59),o=new Date().setTime(new Date().getTime()-3600*1e3*24*7);return[new Date(o).setHours(0,0,0),r]}},{text:"\u4E00\u6708\u5185",value:()=>{const r=new Date().setHours(23,59,59),o=new Date().setTime(new Date().getTime()-3600*1e3*24*30);return[new Date(o).setHours(0,0,0),r]}},{text:"\u534A\u5E74\u5185",value:()=>{const r=new Date().setHours(23,59,59),o=new Date().setTime(new Date().getTime()-3600*1e3*24*182);return[new Date(o).setHours(0,0,0),r]}},{text:"\u4E00\u5E74\u5185",value:()=>{const r=new Date().setHours(23,59,59),o=new Date().setTime(new Date().getTime()-3600*1e3*24*365);return[new Date(o).setHours(0,0,0),r]}},{text:"\u7B2C\u4E00\u5B63\u5EA6",value:()=>{var r=new Date,o=r.getFullYear();const c=new Date(o,0,1).setHours(0,0,0),m=new Date(o,2,31).setHours(23,59,59);return[c,m]}},{text:"\u7B2C\u4E8C\u5B63\u5EA6",value:()=>{var r=new Date,o=r.getFullYear();const c=new Date(o,3,1).setHours(0,0,0),m=new Date(o,5,30).setHours(23,59,59);return[c,m]}},{text:"\u7B2C\u4E09\u5B63\u5EA6",value:()=>{var r=new Date,o=r.getFullYear();const c=new Date(o,6,1).setHours(0,0,0),m=new Date(o,8,30).setHours(23,59,59);return[c,m]}},{text:"\u7B2C\u56DB\u5B63\u5EA6",value:()=>{var r=new Date,o=r.getFullYear();const c=new Date(o,9,1).setHours(0,0,0),m=new Date(o,11,31).setHours(23,59,59);return[c,m]}}]}}],_e=[{type:"input",value:"",label:"\u6D4B\u8BD5\u5355ID",prop:"testTaskID",attrs:{style:{width:"100%"},disabled:!0}},{type:"select",value:"",label:"\u6D4B\u8BD5\u4EBA",prop:"tester",attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"select",value:"",label:"\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",prop:"smokeResult",attrs:{style:{width:"100%"}},children:[{type:"option",value:"pass",label:"\u6210\u529F"},{type:"option",value:"fail",label:"\u5931\u8D25"}]},{type:"input",value:"",label:"\u5931\u8D25\u539F\u56E0",prop:"failedReason",rules:[],attrs:{style:{width:"100%"}}},{type:"select",value:"",label:"\u5931\u8D25\u8D23\u4EFB\u4EBA",prop:"relatedPerson",rules:[{required:!0,message:"\u5931\u8D25\u8D23\u4EFB\u4EBA\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],attrs:{style:{width:"100%"}},children:[]}],be=[{label:"\u6D4B\u8BD5\u5355ID",prop:"testTaskID",align:"left",width:105,sortable:!0,showOverflowTooltip:!0},{label:"\u540D\u79F0",prop:"title",align:"left",sortable:!0,showOverflowTooltip:!0},{label:"\u6240\u5C5E\u4EA7\u54C1",prop:"product",align:"left",showOverflowTooltip:!0},{label:"\u6240\u5C5E\u9879\u76EE",prop:"project",align:"left",showOverflowTooltip:!0},{label:"\u7248\u672C\u53F7",prop:"build",align:"left",showOverflowTooltip:!0,width:110},{label:"\u6D4B\u8BD5\u4EBA",prop:"tester",align:"center",width:90},{label:"\u5931\u8D25\u8D23\u4EFB\u4EBA",prop:"relatedPerson",align:"center",width:100},{label:"\u5931\u8D25\u539F\u56E0",prop:"failedReason",align:"left",showOverflowTooltip:!0,width:100},{label:"\u5F00\u59CB\u65E5\u671F",prop:"begin",align:"left",sortable:!0,width:105},{label:"\u7ED3\u675F\u65E5\u671F",prop:"end",align:"left",sortable:!0,width:105},{label:"\u7ED3\u679C\u6807\u8BB0",prop:"smokeResult",align:"left",slot:"smokeResult",align:"center",width:80},{label:"\u64CD\u4F5C",align:"center",action:!0,width:150}];const ye={class:"wrapper targetSetpage-wrapper"},ke=T("\u67E5\u8BE2"),Te=T("\u91CD\u7F6E"),Ye={key:0,style:{color:"green"}},He={key:1,style:{color:"red"}},Ce={key:2,style:{color:"#f08c5b"}},Re={class:"actionBtns"},Le=T("\u4FEE\u6539"),Ie=T("\u5220\u9664"),Me=T("\u53D6\u6D88"),Oe=T("\u786E\u5B9A"),xe={__name:"smokeTestList",setup(r){const[o,c,m]=pe(),l=ve(),_=f(null);f(null);let Y=f(we),q=f(be),n=f(_e),i=C({testTaskID:"",product:"",tester:"",smokeResult:"",relatedPerson:"",begin:"",end:""}),D=f([]),M=C([]),N=C([]),$=C([]),w=f(!1),E=f({}),O=f({});f("");let B=f(""),b=C({});const{height:J}=ue();ge(()=>{Q()}),V(()=>E.value,e=>{n.value.forEach(t=>{let a=e[t.prop];O.value[t.prop]=a}),b.failedReason=e.failedReason,b.relatedPerson=e.relatedPerson,n.value[0].value=e.testTaskID,n.value[1].value=z(e.testTaskID),n.value[1].children=l.qaList,n.value[2].value=e.smokeResult,e.smokeResult==="pass"?x():e.smokeResult==="fail"&&P(b)}),V(B,e=>{console.log(e),e==="pass"||!e?(n.value[2].value="pass",x()):e==="fail"&&(n.value[2].value="fail",P(b))});const x=()=>{n.value.forEach((e,t)=>{(t===3||t===4)&&(e.value="",e.rules=[],e.attrs.disabled=!0)})},P=e=>{let t=new Map;t.set(3,"\u5931\u8D25\u539F\u56E0"),t.set(4,"\u5931\u8D25\u8D23\u4EFB\u4EBA"),n.value.forEach((a,s)=>{if(s===3||s===4){const v=t.get(s);s===3?a.value=e.failedReason:a.value=e.relatedPerson,a.attrs.disabled=!1,a.rules.push({required:!0,message:`${v}\u4E0D\u80FD\u4E3A\u7A7A`,trigger:"blur"})}})},z=e=>{for(let t=0;t<M.length;t++)if(M[t].testTaskID===e)return M[t].tester},Q=()=>{Y.value[1].children=l.prodSelectList,Y.value[2].children=l.qaList,Y.value[3].children=l.devList,j.getCache("role")!=="top"&&(Y.value[2].value=j.getCache("account"))},S=e=>{me(e).then(t=>{if(!t.data){D.value=[];return}D.value=t.data,M=JSON.parse(JSON.stringify(D.value)),D.value.forEach(a=>{for(let s=0;s<l.userList.length;s++)a.tester===l.userList[s].account&&(a.tester=l.userList[s].realname);for(let s=0;s<l.userList.length;s++)a.relatedPerson===l.userList[s].account&&(a.relatedPerson=l.userList[s].realname);for(let s=0;s<l.prjectList.length;s++)a.project===l.prjectList[s].id&&(a.project=l.prjectList[s].name,$.push({id:a.id,projectId:l.prjectList[s].id}));for(let s=0;s<l.prodList.length;s++)a.product===l.prodList[s].id&&(a.product=l.prodList[s].name,N.push({id:a.id,prodId:l.prodList[s].id}));for(let s=0;s<l.infoList.length;s++)a.build==l.infoList[s].id&&(a.build=l.infoList[s].name)})})},U=e=>{e&&m(e)},W=e=>{const t=_.value.model.testTaskID;if(t){console.log("fail"),_.value.resetFields(),_.value.model.testTaskID=t;const a=[k("1970-1-1").format("YYYY-MM-DD  HH:mm:ss"),k(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")];_.value.model.dateRange=a,Object.keys(i).forEach(s=>{i[s]=""}),i.testTaskID=t,i.begin=a[0],i.end=a[1],S(i)}else{D.value=[];const a=e.model.dateRange;console.log(i.value),e.form.validate(s=>{s?(Object.keys(i).forEach((v,F)=>{i[v]=e.model[v]||""}),i.begin=a[0],i.end=a[1],S(i)):h.error("\u641C\u7D22\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A")})}},X=e=>{let t=_.value.model;t.testTaskID="",t.product="",t.tester=j.getCache("account"),t.relatedPerson="",t.smokeResult="",t.dateRange=[k(new Date(new Date().getTime()-3600*1e3*24*3).setHours(0,0,0)).format("YYYY-MM-DD HH:mm:ss"),k(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")],D.value=[]},A=e=>{n.value[4].children=l.devList,e==="pass"?x():e==="fail"&&(n.value[2].value="fail",P(b))},G=e=>{E.value=JSON.parse(JSON.stringify(e.row)),A(e.row.smokeResult),w.value=!0},K=e=>{B.value=e,e==="pass"?(n.value[2].value="pass",x()):e==="fail"&&(n.value[2].value="fail",P(b))},Z=e=>{const t=e.getFormData();e.validate()(s=>{if(s)if(["smokeResult","failedReason","relatedPerson"].some(g=>O.value[g]!==t[g]))de(t).then(g=>{g.status?h.success(g.message):h.error(g.message),w.value=!1}),S(i);else{h.warning("\u6570\u636E\u672A\u505A\u4FEE\u6539");return}else h.error("\u586B\u5199\u6709\u8BEF"),setTimeout(()=>{e.clearValidate()()},2e3)})},ee=(e,t)=>{t()},te=(e,t)=>{w.value=!1,se(e)},se=e=>{Object.keys(O.value).forEach(t=>{e.model[t]=O.value[t]})},ae=e=>{re.confirm("\u786E\u5B9A\u8981\u5220\u9664\u6B64\u6761\u6570\u636E\u5417?","\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{fe({testTaskID:e.row.testTaskID}).then(t=>{t.code===200&&t.status?(h.success("\u6570\u636E\u5220\u9664\u6210\u529F"),S(i)):h.error(t.message)})}).catch(()=>{h({type:"info",message:"\u5220\u9664\u64CD\u4F5C\u5DF2\u53D6\u6D88"})})};return(e,t)=>{const a=ne,s=R("e-form"),v=R("Select"),F=ie,g=R("CloseBold"),oe=R("e-table"),le=R("e-pop-form");return L(),I("div",ye,[u(s,{ref_key:"form",ref:_,options:y(Y),onDateChange:U},{action:d(p=>[u(a,{type:"primary",onClick:H=>W(p)},{default:d(()=>[ke]),_:2},1032,["onClick"]),u(a,{onClick:H=>X()},{default:d(()=>[Te]),_:2},1032,["onClick"])]),_:1},8,["options"]),u(oe,{data:y(D),options:y(q),tableIndex:"",stripe:"",height:y(J)-280,style:{"margin-top":"46px"}},{smokeResult:d(({scope:p})=>[p.row.smokeResult==="pass"?(L(),I("span",Ye,[u(F,null,{default:d(()=>[u(v)]),_:1})])):p.row.smokeResult==="fail"?(L(),I("span",He,[u(F,null,{default:d(()=>[u(g)]),_:1})])):(L(),I("span",Ce," \u672A\u6807\u8BB0 "))]),action:d(({scope:p})=>[he("div",Re,[u(a,{type:"primary",size:"small",onClick:H=>G(p)},{default:d(()=>[Le]),_:2},1032,["onClick"]),u(a,{type:"danger",size:"small",onClick:H=>ae(p)},{default:d(()=>[Ie]),_:2},1032,["onClick"])])]),_:1},8,["data","options","height"]),u(le,{visible:y(w),"onUpdate:visible":t[0]||(t[0]=p=>De(w)?w.value=p:w=p),options:y(n),title:"\u5355\u6761\u4FEE\u6539\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",width:"30%",isScroll:"",onPopClose:ee,onSelectChange:K},{footer:d(({form:p})=>[u(a,{onClick:H=>te(p,e.id="update")},{default:d(()=>[Me]),_:2},1032,["onClick"]),u(a,{type:"primary",onClick:H=>Z(p)},{default:d(()=>[Oe]),_:2},1032,["onClick"])]),_:1},8,["visible","options"])])}}},Pe=ce(xe,[["__scopeId","data-v-c3cdcd6f"]]),ot={__name:"index",setup(r){return(o,c)=>(L(),I("div",null,[u(Pe)]))}};export{ot as default};
