import{v as V,x as X,y as Z,A as G}from"./element-plus-df419614.js";import{u as K}from"./loggedInfo-268f6dc2.js";import{_ as M}from"./index-66a691da.js";import{r as b,w as F,d as j,a4 as L,o as B,c as I,X as D,Q as d,a as y,W as g,u as p,F as N,V as R,a0 as ee,s as te,P as E,T as P,a7 as ae}from"./@vue-500f6e4a.js";import{d as S}from"./dayjs-d69067b3.js";import{g as oe,u as ne}from"./dateChange-eb10ac1f.js";import{a as se,b as re}from"./index-771e9942.js";import{u as le}from"./deductScore-d679635c.js";import{u as ce}from"./initFormData-b064dc9f.js";import"./lodash-es-8e578a42.js";import"./@element-plus-58134fba.js";import"./@popperjs-892fd7f5.js";import"./@ctrl-eb0b847c.js";import"./async-validator-efc2d198.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";import"./@floating-ui-d1015eb5.js";import"./pinia-d75d73cf.js";import"./index-f3494083.js";import"./axios-805d1980.js";import"./vue-router-a3c91db2.js";import"./lodash-4ca21166.js";import"./pinia-plugin-persistedstate-4761f546.js";const ue=[{label:"\u7985\u9053ID",prop:"ztId",align:"center",slot:"ztId",sortable:!0},{label:"\u7F3A\u9677\u7B49\u7EA7",prop:"severity",align:"center",sortable:!0},{label:"\u7F3A\u9677\u6807\u9898",prop:"title",align:"center",showOverflowTooltip:!0},{label:"\u6240\u5C5E\u9879\u76EE",prop:"projectId",align:"center",sortable:!0,showOverflowTooltip:!0},{label:"\u521B\u5EFA\u4EBA",prop:"openedBy",align:"center"},{label:"\u89E3\u51B3\u4EBA",prop:"resolvedBy",align:"center"},{label:"\u6FC0\u6D3B\u6B21\u6570",prop:"activatedCount",align:"center",sortable:!0},{label:"\u6FC0\u6D3B\u65E5\u671F",prop:"activatedDate",align:"center",sortable:!0}];const ie=R("\u8FD4\u56DE"),de=["onClick"],pe={__name:"index",props:{detailTableData:{type:Object,default:{}}},emits:["backClick"],setup(t,{expose:e,emit:o}){const c=t,r=K();let _=b([]);F(()=>c.detailTableData,n=>{_.value=n}),F(()=>_.value,n=>{_.value=n}),j(()=>{h()});const h=()=>{let n=JSON.parse(JSON.stringify(c.detailTableData));n.forEach(s=>{for(let a=0;a<r.userList.length;a++)s.openedBy===r.userList[a].account&&(s.openedBy=r.userList[a].realname),s.resolvedBy===r.userList[a].account&&(s.resolvedBy=r.userList[a].realname);for(let a=0;a<r.prjectList.length;a++)s.projectId===r.prjectList[a].id&&(s.projectId=r.prjectList[a].name)}),_.value=n};h();const k=()=>{o("backClick")},C=n=>{window.open(n)};return e({getTableData:h}),(n,s)=>{const a=V,i=L("e-table");return B(),I(N,null,[D(a,{type:"primary",plain:"",onClick:k,size:"small",style:{"margin-bottom":"10px"}},{default:d(()=>[ie]),_:1}),y("div",null,[D(i,{options:p(ue),data:p(_),stripe:"",border:""},{ztId:d(({scope:u})=>[y("div",{class:"ztId",onClick:f=>C(u.row.accessLink)},g(u.row.ztId),9,de)]),_:1},8,["options","data"])])],64)}}},ve=M(pe,[["__scopeId","data-v-2651ad21"]]),_e=[{type:"select",value:[],label:"\u59D3\u540D",prop:"resolvedBy",attrs:{style:{width:"100%"},multiple:!0,collapseTags:!0},rules:[{required:!0,message:"\u59D3\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],children:[],multiple:!0},{type:"date-picker",value:[S(new Date(oe()).setHours(0,0,0)).format("YYYY-MM-DD HH:mm:ss"),S(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")],label:"\u65F6\u95F4",prop:"dateRange",rules:[{required:!0,message:"\u65E5\u671F\u9009\u62E9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],attrs:{style:{width:"100%"},multiple:!0,collapseTags:!0,type:"daterange",rangeSeparator:"\u81F3",startPlaceholder:"\u5F00\u59CB\u65E5\u671F",endPlaceholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD HH:mm:ss",shortcuts:[{text:"\u4ECA\u5929",value:()=>{const t=new Date().setHours(0,0,0),e=new Date().setHours(23,59,59);return[t,e]}},{text:"\u4E00\u5468\u5185",value:()=>{const t=new Date().setHours(23,59,59),e=new Date().setTime(new Date().getTime()-3600*1e3*24*7);return[new Date(e).setHours(0,0,0),t]}},{text:"\u4E00\u6708\u5185",value:()=>{const t=new Date().setHours(23,59,59),e=new Date().setTime(new Date().getTime()-3600*1e3*24*30);return[new Date(e).setHours(0,0,0),t]}},{text:"\u534A\u5E74\u5185",value:()=>{const t=new Date().setHours(23,59,59),e=new Date().setTime(new Date().getTime()-3600*1e3*24*182);return[new Date(e).setHours(0,0,0),t]}},{text:"\u4E00\u5E74\u5185",value:()=>{const t=new Date().setHours(23,59,59),e=new Date().setTime(new Date().getTime()-3600*1e3*24*365);return[new Date(e).setHours(0,0,0),t]}},{text:"\u7B2C\u4E00\u5B63\u5EA6",value:()=>{var t=new Date,e=t.getFullYear();const o=new Date(e,0,1).setHours(0,0,0),c=new Date(e,2,31).setHours(23,59,59);return[o,c]}},{text:"\u7B2C\u4E8C\u5B63\u5EA6",value:()=>{var t=new Date,e=t.getFullYear();const o=new Date(e,3,1).setHours(0,0,0),c=new Date(e,5,30).setHours(23,59,59);return[o,c]}},{text:"\u7B2C\u4E09\u5B63\u5EA6",value:()=>{var t=new Date,e=t.getFullYear();const o=new Date(e,6,1).setHours(0,0,0),c=new Date(e,8,30).setHours(23,59,59);return[o,c]}},{text:"\u7B2C\u56DB\u5B63\u5EA6",value:()=>{var t=new Date,e=t.getFullYear();const o=new Date(e,9,1).setHours(0,0,0),c=new Date(e,11,31).setHours(23,59,59);return[o,c]}}],change:t=>{console.log(t)}}}],me=[{label:"\u59D3\u540D",prop:"resolvedBy",align:"center"},{label:"\u7F3A\u9677\u603B\u6570",prop:"bugTotal",align:"center",sortable:!0},{label:"\u6FC0\u6D3B\u7F3A\u9677\u6570",prop:"activatedBugCount",align:"center",sortable:!0,slot:"activatedBugCount"},{label:"\u6FC0\u6D3B\u7F3A\u9677\u6BD4",prop:"activatedBugRate",align:"center",slot:"activatedBugRate",sortable:!0,sortMethod:(t,e)=>parseInt(t-e)},{label:"\u6263\u5206\u6570",prop:"deductPoint",align:"center",sortable:!0,slot:"deductPoint"}];const ge={class:"wrapper"},be=R("\u67E5\u8BE2"),De=R("\u91CD\u7F6E"),fe=["onClick"],we={class:"deRule"},ye={class:"ruleRange"},he={class:"result"},Te={class:"deductPoint"},Be={__name:"index",emits:["addTab"],setup(t,{emit:e}){const[o,c,r]=ne(),[_,h,k,C]=le(),n=ce(),s=b(null);let a=b([]),i=ee({resolvedBy:[],activatedBeginDate:"",activatedEndDate:""}),u=b([]),f=b(_e),H=b("");F(()=>H.value,l=>{C("devActivatedBug",l)}),j(()=>{n(f.value),O(i),C("devActivatedBug",H.value)});const O=l=>{const v=f.value[0].children;se(l).then(T=>{const x=T.data;x&&(u.value=x.map(m=>{for(let Y of v)m.resolvedBy===Y.value&&(m.account=m.resolvedBy,m.resolvedBy=Y.label);return m.activatedBugRate=m.activatedBugRate*100,m}))})},z=async l=>{await re(l).then(v=>{v.data&&(a.value=v.data)})},q=l=>{const v=l.model,T=l.model.dateRange;l.form.validate(x=>{x&&(i.resolvedBy=v.resolvedBy,i.activatedBeginDate=o.value||T[0],i.activatedEndDate=c.value||T[1],O(i))})},A=l=>{o.value="",c.value="",n(f.value),u.value=[]},J=l=>{},Q=l=>{r(l)},U=async l=>{a.value=[];let v=JSON.parse(JSON.stringify(i));v.resolvedBy=l,await z(v),e("addTab",a.value)},W=l=>{H.value=l.activatedBugRate};return(l,v)=>{const T=V,x=L("e-form"),m=X,Y=L("e-table");return B(),I("div",ge,[D(x,{ref_key:"form",ref:s,options:p(f),onVisibleChange:J,onDateChange:Q},{action:d(w=>[D(T,{type:"primary",onClick:$=>q(w)},{default:d(()=>[be]),_:2},1032,["onClick"]),D(T,{onClick:v[0]||(v[0]=$=>A(s.value))},{default:d(()=>[De]),_:1})]),_:1},8,["options"]),D(Y,{options:p(me),data:p(u),stripe:"",border:"",onCellMouseEnter:W},{activatedBugRate:d(({scope:w})=>[R(g(w.row.activatedBugRate.toFixed(2))+"%",1)]),activatedBugCount:d(({scope:w})=>[y("div",{class:"bugCount",onClick:$=>U(w.row.account)},g(w.row.activatedBugCount),9,fe)]),deductPoint:d(({scope:w})=>[D(m,{placement:"top","hide-after":150},{content:d(()=>[y("div",null,[y("div",we,"\u6263\u5206\u89C4\u5219\uFF1A"+g(p(_).rule),1),y("div",ye," \u6263\u5206\u8303\u56F4\uFF1A"+g(p(_).scoreInterval),1),y("div",he," \u5F53\u524D\u8003\u6838\u6307\u6807 "+g(p(H).toFixed(2))+"% \u5728"+g(p(h))+"\u8303\u56F4\uFF0C\u6545\u6263"+g(p(k))+"\u5206 ",1)])]),default:d(()=>[y("div",Te,g(w.row.deductPoint),1)]),_:2},1024)]),_:1},8,["options","data"])])}}},Ce=M(Be,[["__scopeId","data-v-02048495"]]);const xe={class:"wrapper"},ke={__name:"index",setup(t){const e=b(null),o=te([]);let c=b([]);const r=b("\u7EDF\u8BA1\u9875"),_=n=>{if(c.value=n,o.value.length)r.value="\u8BE6\u60C5\u9875";else{const s="\u8BE6\u60C5\u9875";o.value.push({content:ve,name:"\u8BE6\u60C5\u9875",title:"\u8BE6\u60C5\u9875"}),r.value=s}},h=n=>{const s=o.value;let a=r.value;a===n&&s.forEach((i,u)=>{if(i.name===n){const f=s[u+1]||s[u-1];f&&(a=f.name)}}),r.value="\u7EDF\u8BA1\u9875",o.value=s.filter(i=>i.name!==n)},k=()=>{r.value="\u7EDF\u8BA1\u9875"},C=n=>{n==="\u8BE6\u60C5\u9875"&&e.value[0].getTableData()};return(n,s)=>{const a=Z,i=G;return B(),I("div",xe,[D(i,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=u=>r.value=u),type:"card",class:"demo-tabs",onTabRemove:h,onTabChange:C},{default:d(()=>[D(a,{label:"\u7EDF\u8BA1\u9875",name:"\u7EDF\u8BA1\u9875"},{default:d(()=>[(B(),E(P(p(Ce)),{onAddTab:_},null,32))]),_:1}),(B(!0),I(N,null,ae(p(o),u=>(B(),E(a,{key:u.name,label:u.title,name:u.name,closable:""},{default:d(()=>[(B(),E(P(u.content),{onBackClick:k,detailTableData:p(c),ref_for:!0,ref_key:"detailRef",ref:e},null,40,["detailTableData"]))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])}}},Ge=M(ke,[["__scopeId","data-v-37ed6d5a"]]);export{Ge as default};
