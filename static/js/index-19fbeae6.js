import{j as H,v as Re,l as Me,h as Ve}from"./element-plus-df419614.js";import{u as Te}from"./@vueuse-7330b134.js";import{d as D}from"./dayjs-d69067b3.js";import{_ as Le,l as J}from"./index-66a691da.js";import{u as Ne}from"./dateChange-eb10ac1f.js";import{a as Ae,b as Ee,s as Ie}from"./index-4495a6b8.js";import{u as je}from"./loggedInfo-268f6dc2.js";import{g as Fe,r as p,a0 as I,d as Oe,w as te,j as Pe,a4 as M,o as j,c as F,X as d,Q as c,u as g,a as V,E as $,W as xe,V as m,ay as $e,az as qe}from"./@vue-500f6e4a.js";import"./lodash-es-8e578a42.js";import"./@element-plus-58134fba.js";import"./@popperjs-892fd7f5.js";import"./@ctrl-eb0b847c.js";import"./async-validator-efc2d198.js";import"./memoize-one-99e54574.js";import"./escape-html-4bbaf1e1.js";import"./normalize-wheel-es-da779ce4.js";import"./@floating-ui-d1015eb5.js";import"./axios-805d1980.js";import"./vue-router-a3c91db2.js";import"./lodash-4ca21166.js";import"./pinia-d75d73cf.js";import"./pinia-plugin-persistedstate-4761f546.js";import"./index-f3494083.js";const Be=[{type:"input",value:"",label:"\u6D4B\u8BD5\u5355ID",prop:"id",attrs:{style:{width:"100%"},clearable:!0}},{type:"select",value:"",label:"\u4EA7\u54C1\u540D\u79F0",prop:"product",attrs:{style:{width:"100%"},clearable:!0},children:[]},{type:"select",value:"",label:"\u6D4B\u8BD5\u4EBA",prop:"owner",attrs:{style:{width:"100%"},clearable:!0},children:[]},{type:"date-picker",value:[D(new Date(new Date().getTime()-3600*1e3*24*3).setHours(0,0,0)).format("YYYY-MM-DD HH:mm:ss"),D(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")],label:"\u65F6\u95F4",prop:"dateRange",rules:[{required:!0,message:"\u65E5\u671F\u9009\u62E9\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],attrs:{style:{width:"100%"},type:"daterange",rangeSeparator:"\u81F3",startPlaceholder:"\u5F00\u59CB\u65E5\u671F",endPlaceholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD HH:mm:ss",shortcuts:[{text:"\u4ECA\u5929",value:()=>{const o=new Date().setHours(0,0,0),r=new Date().setHours(23,59,59);return[o,r]}},{text:"\u4E00\u5468\u5185",value:()=>{const o=new Date().setHours(23,59,59),r=new Date().setTime(new Date().getTime()-3600*1e3*24*7);return[new Date(r).setHours(0,0,0),o]}},{text:"\u4E00\u6708\u5185",value:()=>{const o=new Date().setHours(23,59,59),r=new Date().setTime(new Date().getTime()-3600*1e3*24*30);return[new Date(r).setHours(0,0,0),o]}},{text:"\u534A\u5E74\u5185",value:()=>{const o=new Date().setHours(23,59,59),r=new Date().setTime(new Date().getTime()-3600*1e3*24*182);return[new Date(r).setHours(0,0,0),o]}},{text:"\u4E00\u5E74\u5185",value:()=>{const o=new Date().setHours(23,59,59),r=new Date().setTime(new Date().getTime()-3600*1e3*24*365);return[new Date(r).setHours(0,0,0),o]}},{text:"\u7B2C\u4E00\u5B63\u5EA6",value:()=>{var o=new Date,r=o.getFullYear();const f=new Date(r,0,1).setHours(0,0,0),b=new Date(r,2,31).setHours(23,59,59);return[f,b]}},{text:"\u7B2C\u4E8C\u5B63\u5EA6",value:()=>{var o=new Date,r=o.getFullYear();const f=new Date(r,3,1).setHours(0,0,0),b=new Date(r,5,30).setHours(23,59,59);return[f,b]}},{text:"\u7B2C\u4E09\u5B63\u5EA6",value:()=>{var o=new Date,r=o.getFullYear();const f=new Date(r,6,1).setHours(0,0,0),b=new Date(r,8,30).setHours(23,59,59);return[f,b]}},{text:"\u7B2C\u56DB\u5B63\u5EA6",value:()=>{var o=new Date,r=o.getFullYear();const f=new Date(r,9,1).setHours(0,0,0),b=new Date(r,11,31).setHours(23,59,59);return[f,b]}}]}},{type:"select",value:"",label:"\u5192\u70DF\u7ED3\u679C",prop:"subStatus",attrs:{style:{width:"100%"},clearable:!0},children:[{type:"option",label:"\u6210\u529F",value:"pass"},{type:"option",label:"\u5931\u8D25",value:"fail"},{type:"option",label:"\u672A\u6807\u8BB0",value:"NA"}]}],Je=[{type:"select",value:"",label:"\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",prop:"smokeResult",attrs:{style:{width:"100%"}},children:[{type:"option",value:"pass",label:"\u6210\u529F"},{type:"option",value:"fail",label:"\u5931\u8D25"},{type:"option",value:"NA",label:"\u672A\u6807\u8BB0"}]},{type:"select",value:"",label:"\u5931\u8D25\u8D23\u4EFB\u4EBA",prop:"relatedPerson",rules:[],attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"input",value:"",label:"\u5931\u8D25\u539F\u56E0",prop:"failedReason",rules:[],attrs:{style:{width:"100%"},disabled:!0}}],ze=[{type:"input",value:"",label:"\u6D4B\u8BD5\u5355ID",prop:"testTaskID",attrs:{style:{width:"100%"},disabled:!0}},{type:"input",value:"",label:"\u540D\u79F0",prop:"title",attrs:{style:{width:"100%"},disabled:!0}},{type:"select",value:"",label:"\u4EA7\u54C1",prop:"product",attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"select",value:"",label:"\u9879\u76EE",prop:"project",attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"select",value:"",label:"\u7248\u672C\u53F7",prop:"build",attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"select",value:"",label:"\u6D4B\u8BD5\u4EBA",prop:"tester",attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"select",value:"",label:"\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",prop:"smokeResult",attrs:{style:{width:"100%"}},children:[{type:"option",value:"pass",label:"\u6210\u529F"},{type:"option",value:"fail",label:"\u5931\u8D25"},{type:"option",value:"NA",label:"\u672A\u6807\u8BB0"}]},{type:"input",value:"",label:"\u5931\u8D25\u539F\u56E0",prop:"failedReason",rules:[],attrs:{style:{width:"100%"},disabled:!0}},{type:"select",value:"",label:"\u5931\u8D25\u8D23\u4EFB\u4EBA",prop:"relatedPerson",rules:[],attrs:{style:{width:"100%"},disabled:!0},children:[]},{type:"date-picker",value:[],label:"\u8D77\u6B62\u65F6\u95F4",prop:"dateRange",attrs:{disabled:!0,style:{width:"100%"},type:"daterange",rangeSeparator:"\u81F3",startPlaceholder:"\u5F00\u59CB\u65E5\u671F",endPlaceholder:"\u7ED3\u675F\u65E5\u671F",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}],Ue=[{label:"\u6D4B\u8BD5\u5355ID",prop:"id",align:"left",sortable:!0},{label:"\u540D\u79F0",prop:"name",align:"left",showOverflowTooltip:!0},{label:"\u6240\u5C5E\u4EA7\u54C1",prop:"product",align:"left",showOverflowTooltip:!0},{label:"\u6240\u5C5E\u9879\u76EE",prop:"project",align:"left",showOverflowTooltip:!0},{label:"\u7248\u672C\u53F7",prop:"build",align:"left",showOverflowTooltip:!0},{label:"\u6D4B\u8BD5\u4EBA",prop:"owner",align:"left"},{label:"\u5F00\u59CB\u65E5\u671F",prop:"begin",align:"left",sortable:!0},{label:"\u7ED3\u675F\u65E5\u671F",prop:"end",align:"left",sortable:!0},{label:"\u7ED3\u679C\u6807\u8BB0",prop:"subStatus",align:"left",slot:"subStatus",align:"center",width:110,sortable:!0},{label:"\u64CD\u4F5C",align:"center",action:!0}];const We=o=>($e("data-v-fe13f305"),o=o(),qe(),o),Qe={class:"wrapper targetSetpage-wrapper"},Xe=m("\u67E5\u8BE2"),Ge=m("\u91CD\u7F6E"),Ke={style:{display:"flex"}},Ze={style:{"padding-left":"2px",margin:"5px 0 10px"}},et=We(()=>V("span",{style:{"padding-left":"1px"}},"\u6279\u91CF\u6807\u8BB0",-1)),tt={key:0,style:{color:"green"}},at={key:1,style:{color:"red"}},lt={key:2,style:{color:"#f08c5b"}},st=m("\u6807\u8BB0"),ot=m("\u53D6\u6D88"),rt=m("\u786E\u5B9A"),nt=m("\u53D6\u6D88"),it=m("\u786E\u5B9A"),ut=m("ID\u4E3A "),dt={style:{color:"red"}},ct=m(" \u7684\u8BB0\u5F55\u5DF2\u88AB\u6807\u8BB0"),pt={class:"dialog-footer"},vt=m("\u53D6\u6D88"),ft=m("\u7EE7\u7EED"),gt={__name:"smokeTestRecord",setup(o){Fe().ctx;const[r,f,b]=Ne(),i=je(),y=p(null),z=p(null),{height:ae}=Te();let T=p(Be),w=p([]),L=p(Je),u=p(ze),v=I({id:"",product:"",owner:"",subStatus:"",begin:"",end:""}),Y=p([]),N=I([]),U=I([]),W=I([]),C=p(!1),S=p(!1),O=p({}),q=p(""),B=I([]),A=p(""),le=p(""),_=p(!1),Q=p([]),E=p([]);Oe(()=>{oe()}),te(()=>O.value,e=>{u.value[0].value=e.id,u.value[1].value=e.name,u.value[4].value=e.build,u.value[4].value=X(e.id,"build")*1,u.value[5].value=X(e.id,"owner"),u.value[6].value=e.subStatus,u.value[9].value=[D(e.begin).format("YYYY-MM-DD "),D(e.end).format("YYYY-MM-DD")]},{deep:!0}),te(q,e=>{});const X=(e,a)=>{for(let t=0;t<N.length;t++)if(N[t].id===e)return N[t][a]},se=Pe(()=>!((A.value==="NA"||A.value==="")&&q.value>0)),oe=()=>{T.value[1].children=i.prodSelectList,T.value[2].children=i.qaList,T.value[4].value="NA",J.getCache("role")!=="top"&&(T.value[2].value=J.getCache("account"))},P=e=>{Ie(e).then(a=>{if(!a.data){Y.value=[];return}Y.value=a.data,N=JSON.parse(JSON.stringify(Y.value)),Y.value.forEach(t=>{for(let l=0;l<i.userList.length;l++)t.owner===i.userList[l].account&&(t.owner=i.userList[l].realname);for(let l=0;l<i.prjectList.length;l++)t.project===i.prjectList[l].id&&(t.project=i.prjectList[l].name,W.push({id:t.id,projectId:i.prjectList[l].id}));for(let l=0;l<i.prodList.length;l++)t.product===i.prodList[l].id&&(t.product=i.prodList[l].name,U.push({id:t.id,prodId:i.prodList[l].id}));for(let l=0;l<i.infoList.length;l++)t.build==i.infoList[l].id&&(t.build=i.infoList[l].name)})})},re=e=>{e&&b(e)},ne=e=>{const a=y.value.model.id;if(a){y.value.resetFields(),y.value.model.id=a;const t=[D("1970-1-1").format("YYYY-MM-DD  HH:mm:ss"),D(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")];y.value.model.dateRange=t,Object.keys(v).forEach(l=>{v[l]=""}),v.id=a,v.begin=t[0],v.end=t[1],console.log(v),P(v)}else{A.value=y.value.model.subStatus,Y.value=[];const t=e.model.dateRange;console.log(v),e.form.validate(l=>{l?(Object.keys(v).forEach((s,h)=>{v[s]=e.model[s]||""}),v.begin=t[0],v.end=t[1],P(v)):(H.error("\u641C\u7D22\u65E5\u671F\u4E0D\u80FD\u4E3A\u7A7A"),setTimeout(()=>{e.form.clearValidate()},2e3))})}},ie=e=>{let a=y.value.model;a.id="",a.product="",a.owner=J.getCache("account"),a.subStatus="NA",a.dateRange=[D(new Date(new Date().getTime()-3600*1e3*24*3).setHours(0,0,0)).format("YYYY-MM-DD HH:mm:ss"),D(new Date().setHours(23,59,59)).format("YYYY-MM-DD HH:mm:ss")],Y.value=[]},ue=()=>{let e,a;U.forEach(t=>{t.id===O.value.id&&(e=t.prodId)}),W.forEach(t=>{t.id===O.value.id&&(a=t.projectId)}),u.value[2].value=e,u.value[2].children=i.prodSelectList,u.value[3].value=a,u.value[3].children=i.projectSelectList,u.value[4].children=i.versionList,u.value[5].children=i.qaList,u.value[8].children=i.devList},de=e=>{O.value=JSON.parse(JSON.stringify(e.row)),ue(),S.value=!0},ce=e=>{e==="pass"?(u.value[6].value="pass",x(u.value,"single")):e==="fail"?(u.value[6].value="fail",K(u.value,"single")):e==="NA"&&(u.value[6].value="NA",x(u.value,"single"))},pe=e=>{const a=e.getFormData();a.begin=a.dateRange[0],a.end=a.dateRange[1],a.smokeResult==="NA"?H.warning("\u6807\u8BB0\u672A\u505A\u4FEE\u6539"):e.validate()(async l=>{l?(await Ae(a).then(s=>{s.status?H.success(s.message):H.error(s.message),S.value=!1}),P(v)):setTimeout(()=>{e.clearValidate()()},2e3)})},ve=(e,a)=>{e.clearValidate()(),G(e),a()},fe=(e,a)=>{console.log(e),e.clearValidate()(),G(e),S.value=!1},G=e=>{e.model.smokeResult="NA",e.model.relatedPerson="",e.model.failedReason="",u.value.forEach((a,t)=>{(t===7||t===8)&&(a.attrs.disabled=!0,a.rules=[])})},ge=e=>{q.value=e.length,B=e},me=()=>{let e=null;(A.value==="NA"||A.value==="")&&(L.value[0].value="NA",L.value[1].children=i.devList,e=L.value),w.value=e},he=()=>{_.value=!1,console.log(E.value),z.value.handleSelectChange(E.value)},be=()=>{if(E.value=B.filter(e=>e.subStatus!=="NA"),E.value.length){_.value=!0;let e=[];E.value.forEach(a=>{e.push(a.id)}),Q.value=e}else me(),C.value=!0},_e=()=>{be()},we=e=>{le.value=e,e==="fail"?(w.value[0].value="fail",K()):e==="pass"?(w.value[0].value="pass",x()):e==="NA"&&(w.value[0].value="NA",x())},x=(e,a)=>{a==="single"?e.forEach((t,l)=>{(l===7||l===8)&&(t.value="",t.rules=[],t.attrs.disabled=!0)}):w.value.forEach((t,l)=>{(l===1||l===2)&&(t.value="",t.rules=[],t.attrs.disabled=!0)})},K=(e,a)=>{if(a==="single"){let t=new Map;t.set(7,"\u5931\u8D25\u539F\u56E0"),t.set(8,"\u5931\u8D25\u8D23\u4EFB\u4EBA"),e.forEach((l,s)=>{if(s===7||s===8){const h=t.get(s);l.value="",l.attrs.disabled=!1,l.rules.push({required:!0,message:`${h}\u4E0D\u80FD\u4E3A\u7A7A`,trigger:"blur"})}})}else{let t=new Map;t.set(1,"\u5931\u8D25\u539F\u56E0"),t.set(2,"\u5931\u8D25\u8D23\u4EFB\u4EBA"),w.value.forEach((l,s)=>{if(s===1||s===2){const h=t.get(s);l.value="",l.attrs.disabled=!1,l.rules.push({required:!0,message:`${h}\u4E0D\u80FD\u4E3A\u7A7A`,trigger:"blur"})}})}},De=(e,a)=>{e.clearValidate()(),Z(e),a()},ye=e=>{const a=B.map(t=>t.id);N.forEach(t=>{for(let l=0;l<a.length;l++)t.id===a[l]&&e.push(t)})},Ye=e=>{let a=[];ye(a);const t=e.getFormData(),l=a.map(s=>({testTaskID:s.id,title:s.name,product:s.product,project:s.project,build:s.build,tester:s.owner,smokeResult:t.smokeResult,failedReason:t.failedReason,relatedPerson:t.relatedPerson,begin:s.begin,end:s.end}));t.smokeResult==="NA"?H.warning("\u6807\u8BB0\u672A\u505A\u4FEE\u6539"):e.validate()(h=>{h?(Ee(l).then(k=>{k.code===200&&k.status?(H.success(k.message),e.resetFields(),C.value=!1):H.error(k.message)}),P(v)):setTimeout(()=>{e.clearValidate()()},2e3)})},Ce=e=>{e.clearValidate()(),Z(e),C.value=!1},Z=e=>{e.model.failedReason="",e.model.relatedPerson="",L.value.forEach((a,t)=>{t!==0&&(a.attrs.disabled=!0,a.rules=[])}),w.value=L.value};return(e,a)=>{const t=Re,l=M("e-form"),s=M("Plus"),h=Me,k=M("Select"),Se=M("CloseBold"),ke=M("e-table"),ee=M("e-pop-form"),He=Ve;return j(),F("div",Qe,[d(l,{ref_key:"form",ref:y,options:g(T),onDateChange:re},{action:c(n=>[d(t,{type:"primary",onClick:R=>ne(n)},{default:c(()=>[Xe]),_:2},1032,["onClick"]),d(t,{onClick:R=>ie()},{default:c(()=>[Ge]),_:2},1032,["onClick"])]),_:1},8,["options"]),V("div",Ke,[V("div",Ze,[d(t,{onClick:_e,type:"primary",disabled:g(se)},{default:c(()=>[d(h,null,{default:c(()=>[d(s)]),_:1}),et]),_:1},8,["disabled"])])]),d(ke,{ref_key:"etableRef",ref:z,data:g(Y),options:g(Ue),onSelectionChange:ge,selectAll:"",stripe:"",height:g(ae)-280},{subStatus:c(({scope:n})=>[n.row.subStatus==="pass"?(j(),F("span",tt,[d(h,null,{default:c(()=>[d(k)]),_:1})])):n.row.subStatus==="fail"?(j(),F("span",at,[d(h,null,{default:c(()=>[d(Se)]),_:1})])):(j(),F("span",lt," \u672A\u6807\u8BB0 "))]),action:c(({scope:n})=>[d(t,{type:"success",size:"small",onClick:R=>de(n),disabled:n.row.subStatus!=="NA"},{default:c(()=>[st]),_:2},1032,["onClick","disabled"])]),_:1},8,["data","options","height"]),d(ee,{visible:g(C),"onUpdate:visible":a[0]||(a[0]=n=>$(C)?C.value=n:C=n),options:g(w),title:"\u6279\u91CF\u4FEE\u6539\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",width:"40%",isScroll:"",onPopClose:De,onSelectChange:we},{footer:c(({form:n})=>[d(t,{onClick:R=>Ce(n)},{default:c(()=>[ot]),_:2},1032,["onClick"]),d(t,{type:"primary",onClick:R=>Ye(n)},{default:c(()=>[rt]),_:2},1032,["onClick"])]),_:1},8,["visible","options"]),d(ee,{visible:g(S),"onUpdate:visible":a[1]||(a[1]=n=>$(S)?S.value=n:S=n),options:g(u),width:"40%",title:"\u5355\u6761\u4FEE\u6539\u5192\u70DF\u7ED3\u679C\u6807\u8BB0",isScroll:"",onPopClose:ve,onSelectChange:ce},{footer:c(({form:n})=>[d(t,{onClick:R=>fe(n,e.id="update")},{default:c(()=>[nt]),_:2},1032,["onClick"]),d(t,{type:"primary",onClick:R=>pe(n)},{default:c(()=>[it]),_:2},1032,["onClick"])]),_:1},8,["visible","options"]),d(He,{modelValue:g(_),"onUpdate:modelValue":a[3]||(a[3]=n=>$(_)?_.value=n:_=n),title:"\u63D0\u793A",width:"30%",top:"12%"},{footer:c(()=>[V("span",pt,[d(t,{onClick:a[2]||(a[2]=n=>$(_)?_.value=!1:_=!1)},{default:c(()=>[vt]),_:1}),d(t,{type:"primary",onClick:he},{default:c(()=>[ft]),_:1})])]),default:c(()=>[V("span",null,[ut,V("span",dt,xe(g(Q)),1),ct])]),_:1},8,["modelValue"])])}}},mt=Le(gt,[["__scopeId","data-v-fe13f305"]]),Pt={__name:"index",setup(o){return(r,f)=>(j(),F("div",null,[d(mt)]))}};export{Pt as default};
